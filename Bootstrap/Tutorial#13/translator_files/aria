var clienttelemetry_build,Microsoft,sct,microsoft;!function(n){n.version="2.7.1"}(clienttelemetry_build||(clienttelemetry_build={}));!function(n){var t;!function(n){!function(n){n[n.BT_STOP=0]="BT_STOP";n[n.BT_STOP_BASE=1]="BT_STOP_BASE";n[n.BT_BOOL=2]="BT_BOOL";n[n.BT_UINT8=3]="BT_UINT8";n[n.BT_UINT16=4]="BT_UINT16";n[n.BT_UINT32=5]="BT_UINT32";n[n.BT_UINT64=6]="BT_UINT64";n[n.BT_FLOAT=7]="BT_FLOAT";n[n.BT_DOUBLE=8]="BT_DOUBLE";n[n.BT_STRING=9]="BT_STRING";n[n.BT_STRUCT=10]="BT_STRUCT";n[n.BT_LIST=11]="BT_LIST";n[n.BT_SET=12]="BT_SET";n[n.BT_MAP=13]="BT_MAP";n[n.BT_INT8=14]="BT_INT8";n[n.BT_INT16=15]="BT_INT16";n[n.BT_INT32=16]="BT_INT32";n[n.BT_INT64=17]="BT_INT64";n[n.BT_WSTRING=18]="BT_WSTRING";n[n.BT_UNAVAILABLE=127]="BT_UNAVAILABLE"}(n.BondDataType||(n.BondDataType={}));n.BondDataType;!function(n){n[n.MARSHALED_PROTOCOL=0]="MARSHALED_PROTOCOL";n[n.MAFIA_PROTOCOL=17997]="MAFIA_PROTOCOL";n[n.COMPACT_PROTOCOL=16963]="COMPACT_PROTOCOL";n[n.JSON_PROTOCOL=21322]="JSON_PROTOCOL";n[n.PRETTY_JSON_PROTOCOL=20554]="PRETTY_JSON_PROTOCOL";n[n.SIMPLE_PROTOCOL=20563]="SIMPLE_PROTOCOL"}(n.ProtocolType||(n.ProtocolType={}));n.ProtocolType}(t=n.Bond||(n.Bond={}))}(Microsoft||(Microsoft={}));!function(n){var t;!function(n){var t;!function(n){var i=function(){function n(){this._buffer=[]}return n.prototype.Add=function(n){for(var t=0;t<this._buffer.length&&this._buffer[t]!=n;++t);t==this._buffer.length&&this._buffer.push(n)},n.prototype.Count=function(){return this._buffer.length},n.prototype.GetBuffer=function(){return this._buffer},n}(),t;n.Set=i;t=function(){function n(){this._buffer=[]}return n.prototype.Add=function(n,t){this._getIndex(n)==-1&&this._buffer.push({Key:n,Value:t})},n.prototype.AddOrReplace=function(n,t){var i=this._getIndex(n);i>=0?this._buffer[i]={Key:n,Value:t}:this._buffer.push({Key:n,Value:t})},n.prototype.Remove=function(n){var t=this._getIndex(n);t>=0&&this._buffer.splice(t,1)},n.prototype.Count=function(){return this._buffer.length},n.prototype.GetBuffer=function(){return this._buffer},n.prototype.ContainsKey=function(n){return this._getIndex(n)>=0},n.prototype.Get=function(n){var t=this._getIndex(n);return t>=0?this._buffer[t].Value:null},n.prototype._getIndex=function(n){for(var t=0,i=-1;t<this._buffer.length;++t)if(this._buffer[t].Key==n){i=t;break}return i},n}();n.Map=t}(t=n.Collections||(n.Collections={}))}(t=n.Bond||(n.Bond={}))}(Microsoft||(Microsoft={}));!function(n){var t;!function(t){var r,u,i;!function(n){var h=function(){function n(){}return n.GetBytes=function(n){for(var t,i=[],r=0;r<n.length;++r)t=n.charCodeAt(r),t<128?i.push(t):t<2048?i.push(192|t>>6,128|63&t):t<55296||t>=57344?i.push(224|t>>12,128|t>>6&63,128|63&t):(t=65536+((1023&t)<<10|1023&n.charCodeAt(++r)),i.push(240|t>>18,128|t>>12&63,128|t>>6&63,128|63&t));return i},n}(),r,u,f,e,o,s;n.Utf8=h;r=function(){function n(){}return n.GetString=function(n){for(var t,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[],e=n.length%3,o=function(n){return[i.charAt(n>>18&63),i.charAt(n>>12&63),i.charAt(n>>6&63),i.charAt(63&n)].join("")},u=0,f=n.length-e;u<f;u+=3)t=(n[u]<<16)+(n[u+1]<<8)+n[u+2],r.push(o(t));switch(e){case 1:t=n[n.length-1];r.push(i.charAt(t>>2));r.push(i.charAt(t<<4&63));r.push("==");break;case 2:t=(n[n.length-2]<<8)+n[n.length-1];r.push(i.charAt(t>>10));r.push(i.charAt(t>>4&63));r.push(i.charAt(t<<2&63));r.push("=")}return r.join("")},n}();n.Base64=r;u=function(){function n(){}return n.GetBytes=function(n){for(var t=[];4294967168&n;)t.push(127&n|128),n>>>=7;return t.push(127&n),t},n}();n.Varint=u;f=function(){function n(){}return n.GetBytes=function(n){for(var t=n.low,i=n.high,r=[];i||4294967168&t;)r.push(127&t|128),t=(127&i)<<25|t>>>7,i>>>=7;return r.push(127&t),r},n}();n.Varint64=f;e=function(){function n(){}return n.GetBytes=function(n){var u,f,r;if(t.BrowserChecker.IsDataViewSupport()){for(u=new DataView(new ArrayBuffer(4)),u.setFloat32(0,n,!0),f=[],r=0;r<4;++r)f.push(u.getUint8(r));return f}return i.ConvertNumberToArray(n,!1)},n}();n.Float=e;o=function(){function n(){}return n.GetBytes=function(n){var u,f,r;if(t.BrowserChecker.IsDataViewSupport()){for(u=new DataView(new ArrayBuffer(8)),u.setFloat64(0,n,!0),f=[],r=0;r<8;++r)f.push(u.getUint8(r));return f}return i.ConvertNumberToArray(n,!0)},n}();n.Double=o;s=function(){function n(){}return n.EncodeZigzag16=function(n){return n=t.Number.ToInt16(n),n<<1^n>>15},n.EncodeZigzag32=function(n){return n=t.Number.ToInt32(n),n<<1^n>>31},n.EncodeZigzag64=function(n){var f=n.low,e=n.high,r=e<<1|f>>>31,u=f<<1,i;return 2147483648&e&&(r=~r,u=~u),i=new t.UInt64("0"),i.low=u,i.high=r,i},n}();n.Zigzag=s}(r=t.Encoding||(t.Encoding={}));!function(r){var h=function(){function n(){}return n.GetString=function(n){for(var t,u,f,r=[],i=0;i<n.length;++i)if(t=n[i],t<=191)r.push(String.fromCharCode(t));else if(t<=223)u=n[++i],r.push(String.fromCharCode((31&t)<<6|63&u));else if(t<=239)u=n[++i],f=n[++i],r.push(String.fromCharCode((15&t)<<12|(63&u)<<6|63&f));else{var u=n[++i],f=n[++i],e=n[++i];t=(7&t)<<18|(63&u)<<12|(63&f)<<6|63&e;t-=65536;r.push(String.fromCharCode(55296|t>>10&1023));r.push(String.fromCharCode(56320|1023&t))}return r.join("")},n}(),u,f,e,o,s;r.Utf8=h;u=function(){function n(){}return n.GetBytes=function(n){for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[],t=0;t<n.length;++t){var o=i.indexOf(n.charAt(t++)),f=i.indexOf(n.charAt(t++)),u=i.indexOf(n.charAt(t++)),e=i.indexOf(n.charAt(t));r.push(o<<2|f>>4);u>=0&&(r.push(f<<4&240|u>>2),e>=0&&r.push(u<<6&192|e))}return r},n}();r.Base64=u;f=function(){function t(){}return t.GetInt64=function(t){var i=new n.Bond.Int64("0"),r=this._Read(t);return i.low=r[0],r.length>1&&(i.high=r[1]),i},t.GetNumber=function(n){return this._Read(n)[0]},t._Read=function(n){for(var t,f=[],r=0,u=!0,i=0;u;){if(t=n.shift(),u=0!=(128&t),t=127&t,!(i<28)){r|=t<<i;f.push(r);r=t>>4;i=3;break}r|=t<<i;i+=7}for(;u;)if(t=n.shift(),u=0!=(128&t),t=127&t,r|=t<<i,i+=7,i>=32)break;return f.push(r),f},t}();r.Varint=f;e=function(){function n(){}return n.GetNumber=function(n){if(t.BrowserChecker.IsDataViewSupport()){for(var u=new DataView(new ArrayBuffer(4)),r=0;r<4;++r)u.setUint8(r,n[r]);return u.getFloat32(0,!0)}return i.ConvertArrayToNumber(n,!1)},n}();r.Float=e;o=function(){function n(){}return n.GetNumber=function(n){if(t.BrowserChecker.IsDataViewSupport()){for(var u=new DataView(new ArrayBuffer(8)),r=0;r<8;++r)u.setUint8(r,n[r]);return u.getFloat64(0,!0)}return i.ConvertArrayToNumber(n,!0)},n}();r.Double=o;s=function(){function t(){}return t.DecodeZigzag16=function(n){return((65535&n)>>>1^-(1&n))<<16>>16},t.DecodeZigzag32=function(n){return n>>>1^-(1&n)},t.DecodeZigzag64=function(t){var f=1&t.high,u=t.high>>>1,e=1&t.low,i=t.low>>>1,r;return i=f<<31|i,e&&(i^=4294967295,u^=4294967295),r=new n.Bond.UInt64("0"),r.low=i,r.high=u,r},t}();r.Zigzag=s}(u=t.Decoding||(t.Decoding={}));i=function(){function n(){}return n.ConvertNumberToArray=function(n,t){var u,c,y,f,s,e,d;if(!n)return t?this._doubleZero:this._floatZero;var w=t?11:8,p=t?52:23,o=(1<<w-1)-1,b=1-o,k=o,v=n<0?1:0;n=Math.abs(n);for(var h=Math.floor(n),l=n-h,a=2*(o+2)+p,r=new Array(a),i=0;i<a;)r[i++]=0;for(i=o+2;i&&h;)r[--i]=h%2,h=Math.floor(h/2);for(i=o+1;i<a-1&&l>0;)l*=2,l>=1?(r[++i]=1,--l):r[++i]=0;for(u=0;u<a&&!r[u];++u);if(c=o+1-u,y=u+p,r[y+1]){for(i=y;i>u&&!(r[i]=1-r[i]);--i);i==u&&++c}if(c>k||h)return v?t?this._doubleNegInifinity:this._floatNegInifinity:t?this._doubleInifinity:this._floatInifinity;if(c<b)return t?this._doubleZero:this._floatZero;if(t){for(f=0,i=0;i<20;++i)f=f<<1|r[++u];for(s=0;i<52;++i)s=s<<1|r[++u];return f|=c+o<<20,f=v<<31|2147483647&f,[255&s,s>>8&255,s>>16&255,s>>>24,255&f,f>>8&255,f>>16&255,f>>>24]}for(e=0,i=0;i<23;++i)e=e<<1|r[++u];return e|=c+o<<23,e=v<<31|2147483647&e,[255&e,e>>8&255,e>>16&255,e>>>24]},n.ConvertArrayToNumber=function(n,i){var c=i?11:8,l=(1<<c-1)-1,a=0!=(128&n[i?7:3]),e=i?(127&n[7])<<4|(240&n[6])>>4:(127&n[3])<<1|(128&n[2])>>7,u,f,o,s,h,r;if(255==e)throw new t.Exception("Not a valid float/double buffer.");if(u=1,f=1,i){if(o=(15&n[6])<<28|(255&n[5])<<20|(255&n[4])<<12,s=n[3]<<24|(255&n[2])<<16|(255&n[1])<<8|255&n[0],!e&&!o&&!s)return 0;for(r=0;r<20;++r)f/=2,o<0&&(u+=f),o<<=1;for(r=0;r<32;++r)f/=2,s<0&&(u+=f),s<<=1}else{if(h=(127&n[2])<<25|(255&n[1])<<17|(255&n[0])<<9,!e&&!h)return 0;for(r=0;r<23;++r)f/=2,h<0&&(u+=f),h<<=1}return u*=Math.pow(2,e-l),a?0-u:u},n._floatZero=[0,0,0,0],n._doubleZero=[0,0,0,0,0,0,0,0],n._floatInifinity=[0,0,128,127],n._floatNegInifinity=[0,0,128,255],n._doubleInifinity=[0,0,0,0,0,0,240,127],n._doubleNegInifinity=[0,0,0,0,0,0,240,255],n}()}(t=n.Bond||(n.Bond={}))}(Microsoft||(Microsoft={}));!function(n){var t;!function(n){var t;!function(t){var i=function(){function t(){this._buffer=[]}return t.prototype.WriteByte=function(t){this._buffer.push(n.Number.ToByte(t))},t.prototype.Write=function(n,t,i){for(;i--;)this.WriteByte(n[t++])},t.prototype.GetBuffer=function(){return this._buffer},t}();t.MemoryStream=i}(t=n.IO||(n.IO={}))}(t=n.Bond||(n.Bond={}))}(Microsoft||(Microsoft={}));!function(n){var t;!function(n){var c=function(){function n(n,t){this.Type=n;this.Id=t}return n}(),t,i,r,u,f,e,o,s,h;n.FieldTag=c;t=function(){function n(n,t){this.ElementType=n;this.Size=t}return n}();n.ContainerTag=t;i=function(){function n(n,t,i){this.KeyType=n;this.ValueType=t;this.Size=i}return n}();n.KeyValueContainerTag=i;r=function(){function n(){}return n}();n.Bonded=r;u=function(){function n(n){this.low=0;this.high=0;this.low=parseInt(n);this.low<0&&(this.high=-1)}return n.prototype.Equals=function(t){var i=new n(t);return this.low==i.low&&this.high==i.high},n}();n.Int64=u;f=function(){function n(n){this.low=0;this.high=0;this.low=parseInt(n)}return n.prototype.Equals=function(t){var i=new n(t);return this.low==i.low&&this.high==i.high},n}();n.UInt64=f;e=function(){function n(){}return n.ToByte=function(n){return this.ToUInt8(n)},n.ToInt8=function(n){var t=(128&n)<<24>>24;return 127&n|t},n.ToInt16=function(n){var t=(32768&n)<<16>>16;return 32767&n|t},n.ToInt32=function(n){var t=2147483648&n;return 2147483647&n|t},n.ToUInt8=function(n){return 255&n},n.ToUInt16=function(n){return 65535&n},n.ToUInt32=function(n){return 4294967295&n},n}();n.Number=e;o=function(){function n(n){this.Message=n}return n}();n.Exception=o;s=function(){function n(){}return n}();n.KeyValuePair=s;h=function(){function n(){}return n.IsDataViewSupport=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},n}();n.BrowserChecker=h}(t=n.Bond||(n.Bond={}))}(Microsoft||(Microsoft={}));!function(n){var t;!function(n){var i=function(){function t(n){this._stream=n}return t.prototype.WriteBlob=function(n){this._stream.Write(n,0,n.length)},t.prototype.WriteBool=function(n){this._stream.WriteByte(n?1:0)},t.prototype.WriteContainerBegin=function(n,t){this.WriteUInt8(t);this.WriteUInt32(n)},t.prototype.WriteMapContainerBegin=function(n,t,i){this.WriteUInt8(t);this.WriteUInt8(i);this.WriteUInt32(n)},t.prototype.WriteContainerEnd=function(){},t.prototype.WriteDouble=function(t){var i=n.Encoding.Double.GetBytes(t);this._stream.Write(i,0,i.length)},t.prototype.WriteFloat=function(t){var i=n.Encoding.Float.GetBytes(t);this._stream.Write(i,0,i.length)},t.prototype.WriteFieldBegin=function(n,t){t<=5?this._stream.WriteByte(n|t<<5):t<=255?(this._stream.WriteByte(192|n),this._stream.WriteByte(t)):(this._stream.WriteByte(224|n),this._stream.WriteByte(t),this._stream.WriteByte(t>>8))},t.prototype.WriteFieldEnd=function(){},t.prototype.WriteFieldOmitted=function(){},t.prototype.WriteInt16=function(t){t=n.Encoding.Zigzag.EncodeZigzag16(t);this.WriteUInt16(t)},t.prototype.WriteInt32=function(t){t=n.Encoding.Zigzag.EncodeZigzag32(t);this.WriteUInt32(t)},t.prototype.WriteInt64=function(t){this.WriteUInt64(n.Encoding.Zigzag.EncodeZigzag64(t))},t.prototype.WriteInt8=function(t){this._stream.WriteByte(n.Number.ToInt8(t))},t.prototype.WriteString=function(t){if(""==t)this.WriteUInt32(0);else{var i=n.Encoding.Utf8.GetBytes(t);this.WriteUInt32(i.length);this._stream.Write(i,0,i.length)}},t.prototype.WriteStructBegin=function(){},t.prototype.WriteStructEnd=function(t){this.WriteUInt8(t?n.BondDataType.BT_STOP_BASE:n.BondDataType.BT_STOP)},t.prototype.WriteUInt16=function(t){var i=n.Encoding.Varint.GetBytes(n.Number.ToUInt16(t));this._stream.Write(i,0,i.length)},t.prototype.WriteUInt32=function(t){var i=n.Encoding.Varint.GetBytes(n.Number.ToUInt32(t));this._stream.Write(i,0,i.length)},t.prototype.WriteUInt64=function(t){var i=n.Encoding.Varint64.GetBytes(t);this._stream.Write(i,0,i.length)},t.prototype.WriteUInt8=function(t){this._stream.WriteByte(n.Number.ToUInt8(t))},t.prototype.WriteWString=function(n){var t,i;for(this.WriteUInt32(n.length),t=0;t<n.length;++t)i=n.charCodeAt(t),this._stream.WriteByte(i),this._stream.WriteByte(i>>>8)},t}(),t;n.CompactBinaryProtocolWriter=i;t=function(){function n(){}return n}();n.CompactBinaryProtocolReader=t}(t=n.Bond||(n.Bond={}))}(Microsoft||(Microsoft={}));!function(n){var t=function(){function t(){}return t.IsSafari=function(){if(null===t._isSafari)if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.toLowerCase();t._isSafari=n.indexOf("safari")>=0&&n.indexOf("chrome")<0?!0:!1}else t._isSafari=!1;return t._isSafari},t.IsReactNative=function(){return null===t._isReactNative&&(t._isReactNative="undefined"!=typeof navigator&&navigator.product?"ReactNative"===navigator.product:!1),t._isReactNative},t.IsUint8ArrSupported=function(){return!n.Utils.IsSafari()&&"undefined"!=typeof Uint8Array&&!n.Utils.IsReactNative()},t.ajax=function(n,i){var r=t._createConnection(),u,f;if(n.headers){u="qsp=true";for(f in n.headers)u+="&",u+=encodeURIComponent(f),u+="=",u+=encodeURIComponent(n.headers[f]);n.url+=n.url.indexOf("?")<0?"?":"&";n.url+=u}r.open(n.type,n.url,!i);n.complete&&(r.onload=function(){"undefined"==typeof r.status&&(r.status=200);n.complete(r)},r.ontimeout=function(){"undefined"==typeof r.status&&(r.status=500);n.complete(r)},r.onerror=function(){n.complete(r)});r.send(n.data)},t.keys=function(n){var t,i;if(Object.keys)return Object.keys(n);t=[];for(i in n)n.hasOwnProperty(i)&&t.push(i);return t},t.IsUsingXDomainRequest=function(){if(null==t._usingXDomainRequest){var n=new XMLHttpRequest;t._usingXDomainRequest="undefined"==typeof n.withCredentials&&"undefined"!=typeof XDomainRequest?!0:!1}return t._usingXDomainRequest},t._createConnection=function(){var n=new XMLHttpRequest;return t.IsUsingXDomainRequest()?new XDomainRequest:n},t._isSafari=null,t._isReactNative=null,t._usingXDomainRequest=null,t}();n.Utils=t}(sct||(sct={}));!function(n){var t;!function(n){var t;!function(n){var t;!function(t){var i=function(){function n(){}return n.GetGuid=function(){var n=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1,5)};return[n(),n(),"-",n(),"-",n(),"-",n(),"-",n(),n(),n()].join("")},n.GetTimeStamp=function(){var t=(new Date).getTime(),n=new Microsoft.Bond.Int64("0");return n.low=4294967295&t,n.high=Math.floor(t/4294967296),n},n.GetTimeStampWithValue=function(n){var t=new Microsoft.Bond.Int64("0");return t.low=4294967295&n,t.high=Math.floor(n/4294967296),t},n}(),r,u,f,e;t.utils=i,function(n){n[n.NotSet=0]="NotSet";n[n.Event=1]="Event";n[n.PerformanceCounter=2]="PerformanceCounter";n[n.Anomaly=3]="Anomaly";n[n.Prediction=4]="Prediction";n[n.TraceLog=5]="TraceLog";n[n.EventSourceLog=6]="EventSourceLog";n[n.HttpLog=7]="HttpLog";n[n.PerformanceCounterAzure=8]="PerformanceCounterAzure";n[n.PerformanceCounterGfs=9]="PerformanceCounterGfs"}(t.RecordType||(t.RecordType={}));t.RecordType;!function(n){n[n.NotSet=0]="NotSet";n[n.O365=1]="O365";n[n.SkypeBI=2]="SkypeBI";n[n.SkypeData=3]="SkypeData"}(t.PIIScrubber||(t.PIIScrubber={}));t.PIIScrubber;!function(n){n[n.NotSet=0]="NotSet";n[n.DistinguishedName=1]="DistinguishedName";n[n.GenericData=2]="GenericData";n[n.IPV4Address=3]="IPV4Address";n[n.IPv6Address=4]="IPv6Address";n[n.MailSubject=5]="MailSubject";n[n.PhoneNumber=6]="PhoneNumber";n[n.QueryString=7]="QueryString";n[n.SipAddress=8]="SipAddress";n[n.SmtpAddress=9]="SmtpAddress";n[n.Identity=10]="Identity";n[n.Uri=11]="Uri";n[n.Fqdn=12]="Fqdn";n[n.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(t.PIIKind||(t.PIIKind={}));t.PIIKind;!function(n){n[n.Unknown=0]="Unknown";n[n.MSACID=1]="MSACID";n[n.MSAPUID=2]="MSAPUID";n[n.ANID=3]="ANID";n[n.OrgIdCID=4]="OrgIdCID";n[n.OrgIdPUID=5]="OrgIdPUID";n[n.UserObjectId=6]="UserObjectId";n[n.Skype=7]="Skype";n[n.Yammer=8]="Yammer";n[n.EmailAddress=9]="EmailAddress";n[n.PhoneNumber=10]="PhoneNumber";n[n.SipAddress=11]="SipAddress";n[n.MUID=12]="MUID"}(t.UserIdType||(t.UserIdType={}));r=(t.UserIdType,function(){function t(){this.ScrubType=n.datamodels.PIIScrubber.NotSet;this.Kind=n.datamodels.PIIKind.NotSet;this.RawContent=""}return t.prototype.Write=function(n){this.WriteImpl(n,!1)},t.prototype.WriteImpl=function(t,i){t.WriteStructBegin(null,i);this.ScrubType!=n.datamodels.PIIScrubber.NotSet?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,1,null),t.WriteInt32(this.ScrubType),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,1,null);this.Kind!=n.datamodels.PIIKind.NotSet?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,2,null),t.WriteInt32(this.Kind),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,2,null);""!=this.RawContent?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,3,null),t.WriteString(this.RawContent),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,3,null);t.WriteStructEnd(i)},t.prototype.Read=function(n){this.ReadImpl(n,!1)},t.prototype.ReadImpl=function(){},t}());t.PII=r;u=function(){function t(){this.Id=i.GetGuid();this.Timestamp=i.GetTimeStamp();this.Type="";this.EventType="";this.Extension=new Microsoft.Bond.Collections.Map;this.RecordType=n.datamodels.RecordType.NotSet;this.PIIExtensions=new Microsoft.Bond.Collections.Map}return t.prototype.AddOrReplacePII=function(t,i,r){var u=new n.datamodels.PII;u.RawContent=i;u.Kind=r;u.ScrubType=n.datamodels.PIIScrubber.O365;this.PIIExtensions.AddOrReplace(t,u)},t.prototype.Write=function(n){this.WriteImpl(n,!1)},t.prototype.WriteImpl=function(t,i){var r,u;if(t.WriteStructBegin(null,i),""!=this.Id?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,1,null),t.WriteString(this.Id),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,1,null),this.Timestamp.Equals("0")?t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT64,3,null):(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT64,3,null),t.WriteInt64(this.Timestamp),t.WriteFieldEnd()),""!=this.Type?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,5,null),t.WriteString(this.Type),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,5,null),""!=this.EventType?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,6,null),t.WriteString(this.EventType),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,6,null),this.Extension.Count()){for(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_MAP,13,null),t.WriteMapContainerBegin(this.Extension.Count(),Microsoft.Bond.BondDataType.BT_STRING,Microsoft.Bond.BondDataType.BT_STRING),r=0;r<this.Extension.GetBuffer().length;++r)t.WriteString(this.Extension.GetBuffer()[r].Key),t.WriteString(this.Extension.GetBuffer()[r].Value);t.WriteContainerEnd();t.WriteFieldEnd()}else t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_MAP,13,null);if(this.RecordType!=n.datamodels.RecordType.NotSet?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,24,null),t.WriteInt32(this.RecordType),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,24,null),this.PIIExtensions.Count()){for(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_MAP,30,null),t.WriteMapContainerBegin(this.PIIExtensions.Count(),Microsoft.Bond.BondDataType.BT_STRING,Microsoft.Bond.BondDataType.BT_STRUCT),u=0;u<this.PIIExtensions.GetBuffer().length;++u)t.WriteString(this.PIIExtensions.GetBuffer()[u].Key),this.PIIExtensions.GetBuffer()[u].Value.WriteImpl(t,!1);t.WriteContainerEnd();t.WriteFieldEnd()}else t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_MAP,30,null);t.WriteStructEnd(i)},t.prototype.Read=function(n){this.ReadImpl(n,!1)},t.prototype.ReadImpl=function(){},t}();t.Record=u;f=function(){function n(){this.Source="";this.DataPackageId="";this.Timestamp=new Microsoft.Bond.Int64("0");this.Records=[]}return n.prototype.Write=function(n){this.WriteImpl(n,!1)},n.prototype.WriteImpl=function(n,t){if(n.WriteStructBegin(null,t),""!=this.Source?(n.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,2,null),n.WriteString(this.Source),n.WriteFieldEnd()):n.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,2,null),""!=this.DataPackageId?(n.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,5,null),n.WriteString(this.DataPackageId),n.WriteFieldEnd()):n.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,5,null),this.Timestamp.Equals("0")?n.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT64,6,null):(n.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT64,6,null),n.WriteInt64(this.Timestamp),n.WriteFieldEnd()),this.Records.length){n.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_LIST,8,null);n.WriteContainerBegin(this.Records.length,Microsoft.Bond.BondDataType.BT_STRUCT);for(var i=0;i<this.Records.length;++i)this.Records[i].WriteImpl(n,!1);n.WriteContainerEnd();n.WriteFieldEnd()}else n.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_LIST,8,null);n.WriteStructEnd(t)},n.prototype.Read=function(n){this.ReadImpl(n,!1)},n.prototype.ReadImpl=function(){},n}();t.DataPackage=f;e=function(){function n(){this.DataPackages=[];this.RequestRetryCount=0}return n.prototype.Write=function(n){this.WriteImpl(n,!1)},n.prototype.WriteImpl=function(n,t){if(n.WriteStructBegin(null,t),this.DataPackages.length){n.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_LIST,1,null);n.WriteContainerBegin(this.DataPackages.length,Microsoft.Bond.BondDataType.BT_STRUCT);for(var i=0;i<this.DataPackages.length;++i)this.DataPackages[i].WriteImpl(n,!1);n.WriteContainerEnd();n.WriteFieldEnd()}else n.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_LIST,1,null);0!=this.RequestRetryCount?(n.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,2,null),n.WriteInt32(this.RequestRetryCount),n.WriteFieldEnd()):n.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,2,null);n.WriteStructEnd(t)},n.prototype.Read=function(n){this.ReadImpl(n,!1)},n.prototype.ReadImpl=function(){},n}();t.ClientToCollectorRequest=e}(t=n.datamodels||(n.datamodels={}))}(t=n.telemetry||(n.telemetry={}))}(t=n.applications||(n.applications={}))}(microsoft||(microsoft={}));!function(n){var t;!function(n){var t;!function(n){var t;!function(t){var e,i,u,o,s,r,f,h,c;!function(n){n[n.SENT=0]="SENT";n[n.SEND_FAILED=1]="SEND_FAILED"}(t.CallbackEventType||(t.CallbackEventType={}));e=t.CallbackEventType;!function(n){n[n.DATARV_ERROR_OK=0]="DATARV_ERROR_OK";n[n.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT";n[n.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG";n[n.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES";n[n.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS";n[n.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG"}(t.DATARV_ERROR||(t.DATARV_ERROR={}));i=t.DATARV_ERROR;u=function(){function n(n){this._errorCode=i.DATARV_ERROR_OK;this._errorCode=n}return n.prototype.ErrorCode=function(){return this._errorCode},n.prototype.toString=function(){switch(this._errorCode){case i.DATARV_ERROR_OK:return"DATARV_ERROR_OK";case i.DATARV_ERROR_INVALID_EVENT:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case i.DATARV_ERROR_INVALID_CONFIG:return"Invalid configuration. CollectorUrl is missing.";case i.DATARV_ERROR_INVALID_DEPENDENCIES:return"DATARV_ERROR_INVALID_DEPENDENCIES";case i.DATARV_ERROR_INVALID_STATUS:return"Telemetry Manager is not initialized.";case i.DATARV_ERROR_INVALID_ARG:return"TenantToken is null or empty, or events is null.";default:return"Unknown error"}},n}();t.Exception=u;o=function(){function n(){}return n}();t.TelemetryConfig=o;s=function(){function n(){}return n.CreateTelemetryManager=function(){return new h},n}();t.TelemetryManagerFactory=s;f=function(){function n(){}return n.MaxPackageSizeInBytes=function(){return 3e6},n.TimeIntervalForNextSendInMS=function(){return 1e3},n}();!function(n){n[n.Created=0]="Created";n[n.Initialized=1]="Initialized";n[n.Started=2]="Started"}(r||(r={}));h=function(){function t(){this._MaxPackageSizeInBytes=f.MaxPackageSizeInBytes();this._listeners=[];this._status=r.Created;this._etag=null;this._testServerResponseHook=null;this._isPaused=!1}return t.prototype.Initialize=function(n){if(this._status!=r.Created)throw new u(i.DATARV_ERROR_INVALID_STATUS);if(!n||!n.collectorUrl)throw new u(i.DATARV_ERROR_INVALID_CONFIG);this._config=n;this._Reset();this._status=r.Initialized;this._Verbose("Initialize() done")},t.prototype.AddListener=function(n){if(this._status<r.Initialized)throw new u(i.DATARV_ERROR_INVALID_STATUS);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",n].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==n)return void this._Verbose("the listener has been added already, index: "+t);this._listeners.push(n);this._Verbose("AddListener() done, the new length: "+this._listeners.length)},t.prototype.RemoveListener=function(n){if(this._status<r.Initialized)throw new u(i.DATARV_ERROR_INVALID_STATUS);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",n].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==n)return 1==this._listeners.length?this._listeners=[]:t==this._listeners.length-1?this._listeners.pop():this._listeners[t]=this._listeners.pop(),void this._Verbose(["this listener has been found, index: ",t,"new length: ",this._listeners.length].join(""));this._Verbose("listener isn't been found, new length"+this._listeners.length)},t.prototype.Start=function(){if(this._status<r.Initialized)throw new u(i.DATARV_ERROR_INVALID_STATUS);this._Verbose(["Start(), status:",this._status,"tag:",t._tag].join(" "));this._status>=r.Started&&this._Verbose("Start() already, ignore");++t._tag;this._status=r.Started;this._Verbose(["Start() done, status: ",this._status,"tag: ",t._tag].join(""))},t.prototype.Stop=function(){if(this._status<r.Initialized)throw new u(i.DATARV_ERROR_INVALID_STATUS);return this._Verbose("Stop(), status: "+this._status),this._status==r.Initialized?void this._Verbose("Stop() already, ignore"):(this._Reset(),this._status=r.Initialized,void this._Verbose("Stop() done, status: "+this._status))},t.prototype.Pause=function(){this._isPaused=!0;this._CleanTimer()},t.prototype.Resume=function(){this._isPaused=!1;this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1)},t.prototype.Flush=function(n){this._eventsCache.IsEmpty()||this._WorkThread(n,!0)},t.prototype.SendAsync=function(n,f){if(this._status<r.Initialized)throw new u(i.DATARV_ERROR_INVALID_STATUS);if(this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",n,"count:",f.length].join(" ")),this._status<r.Started)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!n||!f)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new u(i.DATARV_ERROR_INVALID_ARG);for(var e=0;e<f.length;++e)if(!f[e].Id||!t._eventTypeRegex.test(f[e].EventType)||f[e].Timestamp.Equals("0"))throw this._Error(["eventId:",f[e].Id,"eventType:",f[e].EventType,"timestamp high:",f[e].Timestamp.high,"timestamp low:",f[e].Timestamp.low].join("")),new u(i.DATARV_ERROR_INVALID_EVENT);return this._eventsCache.AddEvents(n,f),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0},t.prototype._WorkThread=function(n,i){var h=this,u,f,s,e,o;try{if(this._Verbose("_WorkThread, status: "+this._status),this._status<r.Started)return void this._Verbose("_WorkThread, status is not started, return");if(u=this._eventsCache.DequeuEvents(),null==u)return this._Verbose("_WorkThread, No events found, return"),void this._CleanTimer();if(f=this._PackEvents(u.tenantToken,u.events),this._eventsCache.AddEvents(u.tenantToken,f.remainedEvents),null==f.buffer||0==f.buffer.length)return void(this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1)));if(this._testServerResponseHook)return s=this._testServerResponseHook(),void setTimeout(this._SendCallback(o,u.tenantToken,f.sendEvents,s,!1,null),100);e={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+clienttelemetry_build.version},complete:function(t){return h._SendCallback(o,u.tenantToken,f.sendEvents,t,i,n)}};sct.Utils.IsUint8ArrSupported()?(this._Verbose("Uint8Array is defined, send with binary format directly."),e.data=new Uint8Array(f.buffer)):(this._Verbose("Uint8Array is undefined, send with base64 encode."),e.data=Microsoft.Bond.Encoding.Base64.GetString(f.buffer),e.headers["content-encoding"]="base64");u.tenantToken&&(e.headers["x-apikey"]=u.tenantToken);o=t._tag;this._lastActiveTime=(new Date).getTime();sct.Utils.ajax(e,i);this._Verbose("_Workthread, send via jquery, tag: "+o)}catch(n){this._Error("_WorkThread, exception: "+n)}},t.prototype._PackEvents=function(t,i){var e,u,f,r,o;for(this._Verbose("_PackageEvents, total Count: "+i.length),e=new n.datamodels.ClientToCollectorRequest,u=new n.datamodels.DataPackage,u.Source="JS_default_source",u.DataPackageId=n.datamodels.utils.GetGuid(),u.Timestamp=n.datamodels.utils.GetTimeStamp(),r=i,i=[];;){if(u.Records=[],u.Records.push.apply(u.Records,r),e.DataPackages=[],e.DataPackages.push(u),f=this._Serialize(e),this._Verbose(["_PackageEvents, sendEvents.length:",r.length,"buffer.length:",f.length,"MaxPackageSize:",this._MaxPackageSizeInBytes].join("")),f.length<this._MaxPackageSizeInBytes)break;if(1==r.length){r=[];f=null;break}o=r.splice(0,Math.floor(r.length/2));this._Verbose("_PackageEvents, too large, package again");i.push.apply(i,r);r=o}return this._Verbose(["_PakcageEvents done, sendEventsCount:",r.length,"buffer.length:",null==f?0:f.length,"remained events:",i.length].join("")),{buffer:f,sendEvents:r,remainedEvents:i}},t.prototype._Serialize=function(n){var t=new Microsoft.Bond.IO.MemoryStream,i=new Microsoft.Bond.CompactBinaryProtocolWriter(t);return n.Write(i),t.GetBuffer()},t.prototype._SendCallback=function(n,i,u,f,o,s){var c,h;if(this._Verbose(["_SendCallback","tag:",n,"current tag:",t._tag,"tenantToken:",i,"events count:",u.length,"jqXHR:",f].join("")),s&&s(f?f.status:0,i,u),!o){if(c=null!=f&&f.status>=200&&f.status<300,this._status<r.Started||n<t._tag)return void this._Verbose("_SendCallback, is not started, or tag is not the same, return");if(!c&&(!f||f.status&&400!=f.status))return this._Verbose("retry statusCode: "+(f?f.status:0)),this._eventsCache.AddEvents(i,u),void this._ScheduleTimer(!0);for(h=0;h<this._listeners.length;++h)this._listeners[h](c?e.SENT:e.SEND_FAILED,f?f.status:0,i,u);this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1))}},t.prototype._CleanTimer=function(){this._Verbose("_CleanTimer(), timer: "+this._timer);this._timer&&(clearTimeout(this._timer),this._timer=null)},t.prototype._ScheduleTimer=function(n){var i=this,t;if(!this._isPaused)if(this._Verbose("_ScheduleTimer: isRetry: "+n),this._CleanTimer(),n)this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor),t=Math.floor(5*this._rescheduleFactor*(1+Math.random())),this._timer=setTimeout(function(){return i._WorkThread(null,!1)},1e3*t),this._Verbose("_ScheduleTimer, next try (s): "+t),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1);else{var t=0,u=(new Date).getTime(),r=u-this._lastActiveTime;t=r>f.TimeIntervalForNextSendInMS()?0:f.TimeIntervalForNextSendInMS()-r;this._timer=setTimeout(function(){return i._WorkThread(null,!1)},t);this._Verbose("_ScheduleTimer, next try: "+t);this._rescheduleFactor=1}},t.prototype._Verbose=function(n){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+n)},t.prototype._Info=function(n){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+n)},t.prototype._Error=function(n){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+n)},t.prototype._Reset=function(){this._Verbose("Reset()");this._CleanTimer();this._lastActiveTime=0;this._rescheduleFactor=1;this._sendingEvents=[];this._eventsCache=new c},t.prototype.__GetListenerArray=function(){return this._listeners},t.prototype.__GetTotalEventsCount=function(){return this._eventsCache.GetTotalEventsCount()},t.prototype.__IsScheduled=function(){return null!=this._timer},t.prototype.__ChageMaxPackageSizeInKB=function(n){this._MaxPackageSizeInBytes=1024*n},t.prototype.__SetTestServerResponseHook=function(n){this._testServerResponseHook=n},t._eventTypeRegex=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,t._tag=0,t}();c=function(){function n(){this._events={};this._tokens=[]}return n.prototype.AddEvents=function(n,t){t.length&&(this._events[n]||(this._events[n]=[],this._tokens.push(n)),this._events[n].push.apply(this._events[n],t))},n.prototype.IsEmpty=function(){return 0==this._tokens.length},n.prototype.DequeuEvents=function(){if(0==this._tokens.length)return null;var n=this._tokens.shift(),t=this._events[n];return delete this._events[n],{tenantToken:n,events:t}},n.prototype.GetTotalEventsCount=function(){var n=0;for(var t in this._events)n+=this._events[t].length;return n},n}()}(t=n._sender||(n._sender={}))}(t=n.telemetry||(n.telemetry={}))}(t=n.applications||(n.applications={}))}(microsoft||(microsoft={}));!function(n){var t;!function(t){var i;!function(t){var u=t._sender.TelemetryManagerFactory.CreateTelemetryManager(),v=function(){function n(){this.collectorUrl=null;this.enableAutoUserSession=!1;this.browserOverrides=new c}return n}(),c,l,s,i,r,o,h,e,f,a;t.LogConfiguration=v;c=function(){function n(){this.onSaveData=null;this.onGetData=null}return n}();t.LogConfigurationBrowserOverrides=c;l=function(){function n(){this.value=null;this.pii=null}return n._isPii=function(n){return null!==n&&void 0!==n&&n!==t.datamodels.PIIKind.NotSet&&!isNaN(n)&&void 0!==t.datamodels.PIIKind[n]},n}();s=function(){function n(){this.name=null;this.timestamp=null;this.properties={};this.eventType=null}return n.prototype.setProperty=function(u,f,e){if(!u||!n._propertyNameRegex.test(u))throw new r(i.INVALID_PROPERTY_NAME);this.properties[u]=e?{value:f,pii:e!=t.datamodels.PIIKind.NotSet?e:null}:{value:f,pii:null}},n._propertyNameRegex=/^[a-zA-Z0-9](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,n}();t.EventProperties=s,function(n){n[n.INVALID_TENANT_TOKEN=1]="INVALID_TENANT_TOKEN";n[n.MISSING_EVENT_PROPERTIES_NAME=2]="MISSING_EVENT_PROPERTIES_NAME";n[n.INVALID_PROPERTY_NAME=3]="INVALID_PROPERTY_NAME";n[n.MISSING_FAILURE_SIGNATURE=5]="MISSING_FAILURE_SIGNATURE";n[n.MISSING_FAILURE_DETAIL=6]="MISSING_FAILURE_DETAIL";n[n.MISSING_PAGEVIEW_ID=7]="MISSING_PAGEVIEW_ID";n[n.MISSING_PAGEVIEW_NAME=8]="MISSING_PAGEVIEW_NAME";n[n.INVALID_SESSION_STATE=9]="INVALID_SESSION_STATE";n[n.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET=10]="INVALID_CONFIGURATION_USE_CUSTOM_GET_SET"}(t.TelemetryError||(t.TelemetryError={}));i=t.TelemetryError;r=function(){function n(n){this.errorCode=null;this.errorCode=n}return n.prototype.ErrorCode=function(){return this.errorCode},n.prototype.toString=function(){switch(this.errorCode){case i.INVALID_TENANT_TOKEN:return"Invalid tenant token";case i.MISSING_EVENT_PROPERTIES_NAME:return"Eventproperties.name can not be null or empty";case i.INVALID_PROPERTY_NAME:return"Invalid Key. Key does not conform to regular expression ^[a-zA-Z0-9](([a-zA-Z0-9|_|.]){0,98}[a-zA-Z0-9])?$";case i.MISSING_FAILURE_SIGNATURE:return"Failure signature can't be null or empty.";case i.MISSING_FAILURE_DETAIL:return"Failure detail can't be null or empty.";case i.MISSING_PAGEVIEW_ID:return"Pageview id can't be null or empty.";case i.MISSING_PAGEVIEW_NAME:return"Pageview name can't be null or empty.";case i.INVALID_SESSION_STATE:return"Session state has to be a value from the SessionState enum.";case i.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET:return"Invalid configuration provided during initialization. Both onGetConfigData and onSaveConfigData must be provided together.  These are manditory when running in a non-brower enviornment";default:return"Unknown error"}},n}();t.Exception=r;o=function(){function i(n){this.contextMap={};this.piiKind=t.datamodels.PIIKind.NotSet;this._allowDeviceInfoFields=!1;this._allowDeviceInfoFields=n}return i.prototype.setAppId=function(n){n&&(this.contextMap["AppInfo.Id"]=n)},i.prototype.setAppVersion=function(n){n&&(this.contextMap["AppInfo.Version"]=n)},i.prototype.setAppLanguage=function(n){n&&(this.contextMap["AppInfo.Language"]=n)},i.prototype.setDeviceId=function(n){n&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.Id"]=n,h.checkAndUpdateDeviceId(n))},i.prototype.setDeviceOsName=function(n){n&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.OsName"]=n)},i.prototype.setDeviceOsVersion=function(n){n&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.OsVersion"]=n)},i.prototype.setDeviceBrowserName=function(n){n&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.BrowserName"]=n)},i.prototype.setDeviceBrowserVersion=function(n){n&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.BrowserVersion"]=n)},i.prototype.setUserId=function(t,i,r){var f,u;if(t&&(this.contextMap["UserInfo.Id"]=t),r)this.contextMap["UserInfo.IdType"]=r;else{switch(i){case n.applications.telemetry.datamodels.PIIKind.SipAddress:f=n.applications.telemetry.datamodels.UserIdType.SipAddress;break;case n.applications.telemetry.datamodels.PIIKind.PhoneNumber:f=n.applications.telemetry.datamodels.UserIdType.PhoneNumber;break;case n.applications.telemetry.datamodels.PIIKind.SmtpAddress:f=n.applications.telemetry.datamodels.UserIdType.EmailAddress;break;default:f=n.applications.telemetry.datamodels.UserIdType.Unknown}this.contextMap["UserInfo.IdType"]=f}if(i)l._isPii(i)&&(this.piiKind=i);else{switch(r){case n.applications.telemetry.datamodels.UserIdType.Skype:u=n.applications.telemetry.datamodels.PIIKind.Identity;break;case n.applications.telemetry.datamodels.UserIdType.EmailAddress:u=n.applications.telemetry.datamodels.PIIKind.SmtpAddress;break;case n.applications.telemetry.datamodels.UserIdType.PhoneNumber:u=n.applications.telemetry.datamodels.PIIKind.PhoneNumber;break;case n.applications.telemetry.datamodels.UserIdType.SipAddress:u=n.applications.telemetry.datamodels.PIIKind.SipAddress;break;default:u=n.applications.telemetry.datamodels.PIIKind.NotSet}l._isPii(u)&&(this.piiKind=u)}},i.prototype.setUserMsaId=function(n){n&&(this.contextMap["UserInfo.MsaId"]=n)},i.prototype.setUserANID=function(n){n&&(this.contextMap["UserInfo.ANID"]=n)},i.prototype.setUserAdvertisingId=function(n){n&&(this.contextMap["UserInfo.AdvertisingId"]=n)},i.prototype.setUserTimeZone=function(n){n&&(this.contextMap["UserInfo.TimeZone"]=n)},i.prototype.setUserLanguage=function(n){n&&(this.contextMap["UserInfo.Language"]=n)},i}();t.SemanticContext=o;h=function(){function n(){}return n.initialize=function(i){var e,o,c,f;this._overrides=i;e=n._getAppLanguage();e&&n.semanticContext.setAppLanguage(e);o=n._getUserLanguage();o&&n.semanticContext.setUserLanguage(o);var s=(new Date).getTimezoneOffset(),r=s%60,u=(s-r)/60,h="+";u>0&&(h="-");u=Math.abs(u);r=Math.abs(r);n.semanticContext.setUserTimeZone(h+(u<10?"0"+u:u.toString())+":"+(r<10?"0"+r:r.toString()));c=n._getUserAgent();c&&(n.semanticContext.setDeviceBrowserName(n._getBrowserName()),n.semanticContext.setDeviceBrowserVersion(n._getBrowserVersion()),n.semanticContext.setDeviceOsName(n._getOsName()),n.semanticContext.setDeviceOsVersion(n._getOsVersion()));f=n._getData(n.DEVICE_ID_COOKIE);f&&""!=f||(f=t.datamodels.utils.GetGuid());n.semanticContext.setDeviceId(f)},n.checkAndUpdateDeviceId=function(t){var r=n._getData(n.DEVICE_ID_COOKIE),i;r!=t&&(n._saveData(n.DEVICE_ID_COOKIE,t),n._saveData(n.FIRST_LAUNCH_TIME_COOKIE,(new Date).getTime().toString()));i=n._getData(n.FIRST_LAUNCH_TIME_COOKIE);n.firstLaunchTime=parseInt(i)},n._saveData=function(n,t){if(this._overrides.onSaveData)this._overrides.onSaveData(n,t);else if("undefined"!=typeof document&&document.cookie)document.cookie=n+"="+t+"; expires=Mon, 31 Dec 2029 23:59:59 GMT"},n._getData=function(n){var t,i;if(this._overrides.onGetData)return this._overrides.onGetData(n)||"";if("undefined"!=typeof document&&document.cookie)for(var u=n+"=",f=document.cookie.split(";"),r=0;r<f.length;r++){for(t=f[r],i=0;" "==t.charAt(i);)i++;if(t=t.substring(i),0==t.indexOf(u))return t.substring(u.length,t.length)}return""},n._getUserAgent=function(){return"undefined"!=typeof navigator?navigator.userAgent||"":""},n._getAppLanguage=function(){return"undefined"!=typeof document&&document.documentElement?document.documentElement.lang:null},n._getUserLanguage=function(){return"undefined"!=typeof navigator?navigator.userLanguage||navigator.language:null},n._userAgentContainsString=function(t){return n._getUserAgent().indexOf(t)>-1},n._isIe=function(){return n._userAgentContainsString("Trident")},n._isEdge=function(){return n._userAgentContainsString(n.BROWSERS.EDGE)},n._isOpera=function(){return n._userAgentContainsString("OPR/")},n._getBrowserName=function(){return n._isOpera()?n.BROWSERS.UNKNOWN:n._userAgentContainsString(n.BROWSERS.PHANTOMJS)?n.BROWSERS.PHANTOMJS:n._isEdge()?n.BROWSERS.EDGE:n._userAgentContainsString(n.BROWSERS.ELECTRON)?n.BROWSERS.ELECTRON:n._userAgentContainsString(n.BROWSERS.CHROME)?n.BROWSERS.CHROME:n._userAgentContainsString(n.BROWSERS.FIREFOX)?n.BROWSERS.FIREFOX:n._userAgentContainsString(n.BROWSERS.SAFARI)?n.BROWSERS.SAFARI:n._userAgentContainsString(n.BROWSERS.SKYPE_SHELL)?n.BROWSERS.SKYPE_SHELL:n._isIe()?n.BROWSERS.MSIE:n.BROWSERS.UNKNOWN},n._getBrowserVersion=function(){function t(){var t,i=n._getUserAgent(),r=i.match(new RegExp(n.BROWSERS.MSIE+" "+n.REGEX_VERSION));return r?r[1]:(t=i.match(new RegExp("rv:"+n.REGEX_VERSION)))?t[1]:void 0}function i(t){var i;return t===n.BROWSERS.SAFARI&&(t="Version"),i=n._getUserAgent().match(new RegExp(t+"/"+n.REGEX_VERSION)),i?i[1]:n.UNKNOWN_VERSION}return n._isIe()?t():i(n._getBrowserName())},n._getOsName=function(){return n._getUserAgent().match(/windows\sphone\s\d+\.\d+/i)?n.OPERATING_SYSTEMS.WINDOWS_PHONE:n._getUserAgent().match(/ arm;/i)?n.OPERATING_SYSTEMS.WINDOWS_RT:n._getUserAgent().match(/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i)?n.OPERATING_SYSTEMS.IOS:n._getUserAgent().match(/android/i)?n.OPERATING_SYSTEMS.ANDROID:n._getUserAgent().match(/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i)?n.OPERATING_SYSTEMS.LINUX:n._getUserAgent().match(/(macintosh|mac os x)/i)?n.OPERATING_SYSTEMS.MACOSX:n._getUserAgent().match(/(windows|win32)/i)?n.OPERATING_SYSTEMS.WINDOWS:n.OPERATING_SYSTEMS.UNKNOWN},n._getOsVersion=function(){function t(){var t=n._getUserAgent().match(new RegExp("Windows NT "+n.REGEX_VERSION));return t&&n.VERSION_MAPPINGS[t[1]]?n.VERSION_MAPPINGS[t[1]]:n.UNKNOWN_VERSION}function i(){var f=n._getUserAgent().match(new RegExp(n.OPERATING_SYSTEMS.MACOSX+" "+n.REGEX_VERSION_MAC)),t,i,u;return f&&(t=f[1].replace(/_/g,"."),i=[],t)?(u=r(t),u?(i=t.split(u),i[0]):t):n.UNKNOWN_VERSION}function r(n){return n.indexOf(".")>-1?".":n.indexOf("_")>-1?"_":null}return n._getOsName()===n.OPERATING_SYSTEMS.WINDOWS?t():n._getOsName()===n.OPERATING_SYSTEMS.MACOSX?i():n.UNKNOWN_VERSION},n.semanticContext=new o(!0),n.firstLaunchTime=-1,n.BROWSERS={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",UNKNOWN:"Unknown"},n.OPERATING_SYSTEMS={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",UNKNOWN:"Unknown"},n.VERSION_MAPPINGS={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},n.REGEX_VERSION="([\\d,.]+)",n.REGEX_VERSION_MAC="([\\d,_,.]+)",n.UNKNOWN_VERSION="Unknown",n.DEVICE_ID_COOKIE="MicrosoftApplicationsTelemetryDeviceId",n.FIRST_LAUNCH_TIME_COOKIE="MicrosoftApplicationsTelemetryFirstLaunchTime",n}();!function(n){n[n.STARTED=0]="STARTED";n[n.ENDED=1]="ENDED"}(t.SessionState||(t.SessionState={}));e=t.SessionState;f=function(){function n(){}return n.initialize=function(t,f){if(!n._initialized){if(!t)throw new r(i.INVALID_TENANT_TOKEN);if(n._defaultToken=t,n._tmConfig.collectorUrl="https://browser.pipe.aria.microsoft.com/Collector/3.0/",n._configuration=f,!("undefined"!=typeof window||f&&f.browserOverrides&&f.browserOverrides.onGetData))throw new r(i.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET);var o=new c;if(f&&(f.collectorUrl&&(n._tmConfig.collectorUrl=f.collectorUrl),f.browserOverrides)){if(f.browserOverrides.onGetData?!f.browserOverrides.onSaveData:!!f.browserOverrides.onSaveData)throw new r(i.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET);o.onGetData=f.browserOverrides.onGetData;o.onSaveData=f.browserOverrides.onSaveData}u.Initialize(n._tmConfig);u.Start();h.initialize(o);n._initialized=!0;"undefined"!=typeof window&&window.addEventListener&&(f&&f.enableAutoUserSession&&(n._logger=new a,n._logger.logSession(e.STARTED)),window.addEventListener("beforeunload",n._teardown))}},n.pauseTransmission=function(){u.Pause()},n.resumeTransmission=function(){u.Resume()},n.flush=function(n){u.Flush(n)},n.addCallbackListener=function(t){n._initialized&&u.AddListener(t)},n.setContext=function(t,i,r){n._contextProperties.setProperty(t,i,r)},n.isInitialized=function(){return n._initialized},n.getDefaultToken=function(){return n._defaultToken},n.getSemanticContext=function(){return n._semanticContext},n._getInitIdForToken=function(i){return n._initIdMap[i]||(n._initIdMap[i]=t.datamodels.utils.GetGuid()),n._initIdMap[i]},n._getSequenceForToken=function(t){return n._sequenceMap[t]||(n._sequenceMap[t]=0),n._sequenceMap[t]++,n._sequenceMap[t]},n._teardown=function(){n._logger&&n._logger.logSession(e.ENDED);n.flush()},n.__backToUninitialized=function(){n._tmConfig=new t._sender.TelemetryConfig;n._semanticContext=new o(!0);n._contextProperties=new s;n._configuration=null;u=t._sender.TelemetryManagerFactory.CreateTelemetryManager();n._initialized=!1;n._initIdMap={};n._sequenceMap={}},n._initialized=!1,n._defaultToken=null,n._tmConfig=new t._sender.TelemetryConfig,n._logger=null,n._initIdMap={},n._sequenceMap={},n._configuration=null,n._contextProperties=new s,n._semanticContext=new o(!0),n}();t.LogManager=f;a=function(){function n(n){this._initId=null;this._tenantToken=null;this._contextProperties=new s;this._semanticContext=new o(!1);this._sessionStartTime=0;this._sessionId=null;this._tenantToken=n?n:f.getDefaultToken();this._initId=f._getInitIdForToken(this._tenantToken)}return n.prototype.logEvent=function(n){if(!n.name)throw new r(i.MISSING_EVENT_PROPERTIES_NAME);var t=this._createEventRecord(n.name,n.eventType);this._addPropertiesAndSendEvent(t,n)},n.prototype.logFailure=function(n,t,u,f,e){if(!n)throw new r(i.MISSING_FAILURE_SIGNATURE);if(!t)throw new r(i.MISSING_FAILURE_DETAIL);var o=this._createEventRecord("failure","failure");o.Extension.Add("Failure.Signature",n);o.Extension.Add("Failure.Detail",t);u&&o.Extension.Add("Failure.Category",u);f&&o.Extension.Add("Failure.Id",f);this._addPropertiesAndSendEvent(o,e)},n.prototype.logPageView=function(n,t,u,f,e,o){if(!n)throw new r(i.MISSING_PAGEVIEW_ID);if(!t)throw new r(i.MISSING_PAGEVIEW_NAME);var s=this._createEventRecord("pageview","pageview");s.Extension.Add("PageView.Id",n);s.Extension.Add("PageView.Name",t);u&&s.Extension.Add("PageView.Category",u);f&&s.Extension.Add("PageView.Uri",f);e&&s.Extension.Add("PageView.ReferrerUri",e);this._addPropertiesAndSendEvent(s,o)},n.prototype.logSession=function(n,u){var f,o;if(n!==e.STARTED&&n!==e.ENDED)throw new r(i.INVALID_SESSION_STATE);if(f=this._createEventRecord("session","session"),n===e.STARTED){if(this._sessionStartTime>0)return;this._sessionStartTime=(new Date).getTime();this._sessionId=t.datamodels.utils.GetGuid();f.Extension.Add("Session.Id",this._sessionId);f.Extension.Add("Session.State","Started")}else if(n===e.ENDED){if(0==this._sessionStartTime)return;o=Math.floor(((new Date).getTime()-this._sessionStartTime)/1e3);f.Extension.Add("Session.Duration",o.toString());f.Extension.Add("Session.DurationBucket",this._getSessionDurationFromTime(o));f.Extension.Add("Session.Id",this._sessionId);f.Extension.Add("Session.State","Ended");this._sessionId=null;this._sessionStartTime=0}f.Extension.Add("Session.FirstLaunchTime",this._getISOString(new Date(h.firstLaunchTime)));this._addPropertiesAndSendEvent(f,u)},n.prototype.getSessionId=function(){return this._sessionId},n.prototype.setContext=function(n,t,i){this._contextProperties.setProperty(n,t,i)},n.prototype.getSemanticContext=function(){return this._semanticContext},n.prototype._getSessionDurationFromTime=function(n){return n<0?"Undefined":n<=3?"UpTo3Sec":n<=10?"UpTo10Sec":n<=30?"UpTo30Sec":n<=60?"UpTo60Sec":n<=180?"UpTo3Min":n<=600?"UpTo10Min":n<=1800?"UpTo30Min":"Above30Min"},n.prototype._createEventRecord=function(n,i){var r=new t.datamodels.Record,u;return i||(i="custom"),r.EventType=n.toLowerCase(),r.Type=i.toLowerCase(),r.Extension.Add("EventInfo.Source","JS_default_source"),r.Extension.Add("EventInfo.InitId",this._initId),r.Extension.Add("EventInfo.Sequence",f._getSequenceForToken(this._tenantToken).toString()),r.Extension.Add("EventInfo.Name",n.toLowerCase()),u=new Date,r.Timestamp=t.datamodels.utils.GetTimeStampWithValue(u.getTime()),r.Extension.Add("EventInfo.Time",this._getISOString(u)),r.Extension.Add("EventInfo.SdkVersion","ACT-Web-JS-"+clienttelemetry_build.version),r},n.prototype._getISOString=function(n){function t(n){return n<10?"0"+n:n.toString()}function i(n){return n<10?"00"+n:n<100?"0"+n:n.toString()}return n.getUTCFullYear()+"-"+t(n.getUTCMonth()+1)+"-"+t(n.getUTCDate())+"T"+t(n.getUTCHours())+":"+t(n.getUTCMinutes())+":"+t(n.getUTCSeconds())+"."+i(n.getUTCMilliseconds())+"Z"},n.prototype._addCustomPropertiesToEvent=function(n,t){this._addSemanticContext(n,h.semanticContext);this._addSemanticContext(n,f._semanticContext);this._addSemanticContext(n,this._semanticContext);this._sessionId&&n.Extension.Add("Session.Id",this._sessionId);this._addEventPropertiesToEvent(n,f._contextProperties);this._addEventPropertiesToEvent(n,this._contextProperties);this._addEventPropertiesToEvent(n,t)},n.prototype._addSemanticContext=function(n,i){var u,r;if(i&&i.contextMap){u=i.contextMap;for(r in i.contextMap)"UserInfo.Id"==r&&i.piiKind!=t.datamodels.PIIKind.NotSet?n.AddOrReplacePII(r,u[r],i.piiKind):n.Extension.AddOrReplace(r,u[r])}},n.prototype._addEventPropertiesToEvent=function(n,i){var u,r;if(i&&(i.timestamp&&i.timestamp>=new Date("1/1/2000").getTime()&&(n.Timestamp=t.datamodels.utils.GetTimeStampWithValue(i.timestamp),n.Extension.AddOrReplace("EventInfo.Time",this._getISOString(new Date(i.timestamp)))),i.name&&(n.EventType=i.name.toLowerCase(),n.Extension.AddOrReplace("EventInfo.Name",i.name.toLowerCase())),u=i.properties,u))for(r in u)r&&(u[r].value||u[r].value===!1||0==u[r].value||""==u[r].value)&&(l._isPii(u[r].pii)?(n.AddOrReplacePII(r,u[r].value.toString(),u[r].pii),n.Extension.Remove(r)):(n.Extension.AddOrReplace(r,u[r].value.toString()),n.PIIExtensions.Remove(r)))},n.prototype._addPropertiesAndSendEvent=function(n,t){this._addCustomPropertiesToEvent(n,t);f.isInitialized()&&(this._sanitizeName(n),u.SendAsync(this._tenantToken,[n]))},n.prototype._sanitizeName=function(n){var t=n.EventType.replace(/\./g,"_");n.EventType=t;n.Extension.AddOrReplace("EventInfo.Name",t)},n}();t.Logger=a}(i=t.telemetry||(t.telemetry={}))}(t=n.applications||(n.applications={}))}(microsoft||(microsoft={}));"undefined"!=typeof module&&(module.exports=microsoft.applications.telemetry)